(function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],l=0,f=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={app:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"3f82":function(e,t,n){var r,i,o,a=n("448a").default,s=n("3c96").default,c=n("970b").default,u=n("5bc3").default,d=n("ed6d").default,l=n("2d0d").default,f=n("7037").default;n("96cf"),n("6c57"),n("d3b7"),n("159b"),n("d81d"),n("99af"),n("4de4"),n("b64b"),n("ac1f"),n("5319"),n("b0c0"),n("25f0"),n("a15b"),function(a,s){"object"==f(t)&&"undefined"!=typeof e?s(t,n("78b2"),n("703a")):(i=[t,n("78b2"),n("703a")],r=s,o="function"===typeof r?r.apply(t,i):r,void 0===o||(e.exports=o))}(0,(function(e,t,n){"use strict";var r,i,o,f,v,g,p,m,h=new t.Logger("RTC-A");
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.
  
      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.
  
      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */function R(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}e.LiveType=void 0,(r=e.LiveType||(e.LiveType={}))[r.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",r[r.AUDIO=1]="AUDIO",e.Mode=void 0,(i=e.Mode||(e.Mode={}))[i.RTC=0]="RTC",i[i.LIVE=2]="LIVE",e.ROLE=void 0,(o=e.ROLE||(e.ROLE={}))[o.ANCHOR=1]="ANCHOR",o[o.AUDIENCE=2]="AUDIENCE",e.Resolution=void 0,(f=e.Resolution||(e.Resolution={}))["176_132"]="RESOLUTION_176_132",f["240_240"]="RESOLUTION_240_240",f["256_144"]="RESOLUTION_256_144",f["320_180"]="RESOLUTION_320_180",f["320_240"]="RESOLUTION_320_240",f["480_360"]="RESOLUTION_480_360",f["480_480"]="RESOLUTION_480_480",f["640_360"]="RESOLUTION_640_360",f["640_480"]="RESOLUTION_640_480",f["720_480"]="RESOLUTION_720_480",f["1280_720"]="RESOLUTION_1280_720",f["1920_1080"]="RESOLUTION_1920_1080",e.StorageType=void 0,(v=e.StorageType||(e.StorageType={}))[v.ROOM=1]="ROOM",v[v.USER=2]="USER",e.StreamSize=void 0,(g=e.StreamSize||(e.StreamSize={}))[g.MAX=1]="MAX",g[g.MIN=2]="MIN",e.StreamType=void 0,(p=e.StreamType||(e.StreamType={}))[p.NODE=-1]="NODE",p[p.AUDIO=0]="AUDIO",p[p.VIDEO=1]="VIDEO",p[p.AUDIO_AND_VIDEO=2]="AUDIO_AND_VIDEO",e.RCAdapterCode=void 0,(m=e.RCAdapterCode||(e.RCAdapterCode={}))[m.ANDIENCE_CANNOT_JOIN_ROOM=53901]="ANDIENCE_CANNOT_JOIN_ROOM",m[m.GET_SCREEN_STREAM_FAILED=53902]="GET_SCREEN_STREAM_FAILED",m[m.NOT_AUCHOR=53903]="NOT_AUCHOR";var I=function(t){d(i,t);var r=l(i);function i(e){var t;return c(this,i),t=r.call(this),t._options=e,t._client=e.client,t}return u(i,[{key:"getRTCClient",value:function(){return this._client}},{key:"getRTCMode",value:function(){return this._options.mode||e.Mode.RTC}},{key:"getLiveRole",value:function(){return this._options.liveRole}},{key:"getLiveType",value:function(){return this._options.liveType}},{key:"checkRoomThen",value:function(e){return R(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this._room?e(this._room,this._client.getCurrentId()):Promise.reject({code:n.RCRTCCode.NOT_IN_ROOM}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"checkAuchorThen",value:function(t){return R(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(i=this.getRTCMode(),o=this.getLiveRole(),i===e.Mode.LIVE&&o===e.ROLE.ANCHOR){r.next=3;break}return r.abrupt("return",Promise.reject({code:e.RCAdapterCode.NOT_AUCHOR}));case 3:if(this._room){r.next=5;break}return r.abrupt("return",Promise.reject({code:n.RCRTCCode.NOT_IN_ROOM}));case 5:return a=this._room,r.abrupt("return",t(a));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"join",value:function(t){return R(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,a,s,c,u=this;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(this._options.mode!==e.Mode.LIVE){r.next=8;break}if(this._options.liveRole===e.ROLE.ANCHOR){r.next=3;break}return r.abrupt("return",Promise.reject({code:e.RCAdapterCode.ANDIENCE_CANNOT_JOIN_ROOM}));case 3:return r.next=5,this._client.joinLivingRoom(t,this._options.liveType||0);case 5:i=r.sent,r.next=11;break;case 8:return r.next=10,this._client.joinRTCRoom(t);case 10:i=r.sent;case 11:if(o=i,a=o.code,a===n.RCRTCCode.SUCCESS){r.next=14;break}return r.abrupt("return",Promise.reject({code:a}));case 14:return s=i.room,this._setCrtRoom(s),c=s.getRemoteUserIds(),r.abrupt("return",(setTimeout((function(){var e;null===(e=u.onUserJoin)||void 0===e||e.call(u,c),c.forEach((function(e){var t,n=s.getRemoteTracksByUserId(e);n.length&&(null===(t=u.onTrackPublish)||void 0===t||t.call(u,n))}))}),30),{users:c.map((function(e){return{id:e}}))}));case 18:case"end":return r.stop()}}),r,this)})))}},{key:"leaveRoom",value:function(){var e;return R(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=null===(e=this._room)||void 0===e?void 0:e.getLocalTracks(),t.next=3,this._client.leaveRoom(this._room);case 3:return i=t.sent,o=i.code,t.abrupt("return",(null==r||r.every((function(e){return e.destroy()})),this.emit("onLeaveRoom"),o===n.RCRTCCode.SUCCESS?(this._room=void 0,Promise.resolve()):Promise.reject({code:o})));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"changeLiveRole",value:function(t){return R(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.t0=this._options.liveRole===e.ROLE.ANCHOR&&this._room,!n.t0){n.next=4;break}return n.next=4,this.leaveRoom();case 4:this._options.liveRole=t;case 5:case"end":return n.stop()}}),n,this)})))}},{key:"_setCrtRoom",value:function(e){var t=this;this._room=e,e.registerReportListener({onStateReport:function(e){var n,r;null===(n=t.onReportListener)||void 0===n||n.call(t,e),null===(r=t.onMonitorListener)||void 0===r||r.call(t,e)}}),e.registerRoomEventListener({onUserJoin:function(e){var n;null===(n=t.onUserJoin)||void 0===n||n.call(t,e)},onUserLeave:function(e){var n;null===(n=t.onUserLeave)||void 0===n||n.call(t,e)},onKickOff:function(e){var n;null===(n=t.onKickOff)||void 0===n||n.call(t)},onMessageReceive:function(e,n,r,i){var o;null===(o=t.onMessageReceive)||void 0===o||o.call(t,e,n,r,i)},onTrackPublish:function(e){var n;null===(n=t.onTrackPublish)||void 0===n||n.call(t,e)},onTrackUnpublish:function(e){var n;null===(n=t.onTrackUnpublish)||void 0===n||n.call(t,e)},onTrackReady:function(e){var n;null===(n=t.onTrackReady)||void 0===n||n.call(t,e)},onAudioMuteChange:function(e){var n;null===(n=t.onAudioMuteChange)||void 0===n||n.call(t,e)},onVideoMuteChange:function(e){var n;null===(n=t.onVideoMuteChange)||void 0===n||n.call(t,e)},onRoomAttributeChange:function(e,n){var r;null===(r=t.onRoomAttributeChange)||void 0===r||r.call(t,e,n)}})}},{key:"destroy",value:function(){this.emit(i.__INNER_EVENT_DESTROY__),this.clear()}}],[{key:"init",value:function(e){this._instance=new i(e)}},{key:"destroy",value:function(){this._instance.destroy(),this._instance=null}},{key:"getInstance",value:function(){return this._instance}}]),i}(t.EventEmitter);I._instance=null,I.__INNER_EVENT_DESTROY__="inner-destroy";var y=function(){function e(){c(this,e);var t=I.getInstance();t?(this._ctrl=t,this._ctrl.on(I.__INNER_EVENT_DESTROY__,this.onDestroy,this)):h.error("RCRTCAdapter not initialize yet")}return u(e,[{key:"onDestroy",value:function(){}}]),e}(),T={RESOLUTION_176_132:{width:176,height:132,maxBitRate:150,minBitRate:80},RESOLUTION_256_144:{width:256,height:144,maxBitRate:240,minBitRate:120},RESOLUTION_320_180:{width:320,height:180,maxBitRate:280,minBitRate:120},RESOLUTION_240_240:{width:240,height:240,maxBitRate:280,minBitRate:120},RESOLUTION_320_240:{width:320,height:240,maxBitRate:400,minBitRate:120},RESOLUTION_480_360:{width:480,height:360,maxBitRate:650,minBitRate:150},RESOLUTION_640_360:{width:640,height:360,maxBitRate:800,minBitRate:180},RESOLUTION_480_480:{width:480,height:480,maxBitRate:800,minBitRate:180},RESOLUTION_640_480:{width:640,height:480,maxBitRate:900,minBitRate:200},RESOLUTION_720_480:{width:720,height:480,maxBitRate:1e3,minBitRate:200},RESOLUTION_1280_720:{width:1280,height:720,maxBitRate:2200,minBitRate:250},RESOLUTION_1920_1080:{width:1920,height:1080,maxBitRate:4e3,minBitRate:400}},_={height:480,width:640,frameRate:15},C=function(e){return R(void 0,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:return t.t0=t.sent,t.abrupt("return",{mediaStream:t.t0});case 7:return t.prev=7,t.t1=t["catch"](0),t.abrupt("return",Promise.reject({code:n.RCRTCCode.GET_USER_MEDIA_FAILED}));case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))},O=function(t,n,r){return(t===e.StreamType.AUDIO_AND_VIDEO?[e.StreamType.AUDIO,e.StreamType.VIDEO]:[t]).map((function(e){return"".concat(n,"_").concat(r,"_").concat(e)}))},E=function(e){var t={audio:!1,video:!1};return e.forEach((function(e){var n=!(e.isLocalMuted()||e.isOwnerMuted());t[e.isAudioTrack()?"audio":"video"]=n})),t},b=function(e){var t,n;return{audio:!!(null===(t=e.getAudioTracks()[0])||void 0===t?void 0:t.enabled),video:!!(null===(n=e.getVideoTracks()[0])||void 0===n?void 0:n.enabled)}},S=function(t){d(i,t);var r=l(i);function i(t){var n;c(this,i),n=r.call(this),n._promiseMaps={},n._options=Object.assign({},t);var o=s(n),a=function(e,t,r){return R(s(n),void 0,void 0,regeneratorRuntime.mark((function n(){var i,o,a=this;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=this._ctrl.getRTCClient().getCurrentId(),o=O(e,r.id,r.stream.tag)[0],n.abrupt("return",this._ctrl.checkRoomThen((function(e){return R(a,void 0,void 0,regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=i===r.id?e.getLocalTrack(o):e.getRemoteTrack(o),a&&(t?a.unmute():a.mute());case 2:case"end":return n.stop()}}),n)})))})));case 2:case"end":return n.stop()}}),n,this)})))};return n.video={disable:a.bind(o,e.StreamType.VIDEO,!1),enable:a.bind(o,e.StreamType.VIDEO,!0)},n.audio={mute:a.bind(o,e.StreamType.AUDIO,!1),unmute:a.bind(o,e.StreamType.AUDIO,!0)},n._ctrl.onTrackPublish=function(t){var r=n._options.published;if(r){var i={};for(var o in t.forEach((function(e){var t=e.getTag();(i[t]=i[t]||[]).push(e)})),i){var a=i[o],s=a[0],c=2===a.length?e.StreamType.AUDIO_AND_VIDEO:s.isAudioTrack()?e.StreamType.AUDIO:e.StreamType.VIDEO;r({id:s.getUserId(),stream:{tag:o,type:c,enable:E(a)}})}}},n._ctrl.onTrackUnpublish=function(t){var n=o._options.unpublished;if(n){var r={};for(var i in t.forEach((function(e){var t=e.getTag();(r[t]=r[t]||[]).push(e)})),r){var a=r[i],s=a[0],c=2===a.length?e.StreamType.AUDIO_AND_VIDEO:s.isAudioTrack()?e.StreamType.AUDIO:e.StreamType.VIDEO;n({id:s.getUserId(),stream:{tag:i,type:c,enable:E(a)}})}}},n._ctrl.onTrackReady=function(t){var n=t.getStreamId(),r=i._streamMaps[n]=i._streamMaps[n]||new MediaStream;(t.isAudioTrack()?r.getAudioTracks():r.getVideoTracks()).forEach((function(e){return r.removeTrack(e)}));var a=o._promiseMaps[n];if(a){var s=a.options,c=a.resolve,u=a.tracks;if(o._promiseMaps[n].tracks.push(t),s.stream.type===e.StreamType.AUDIO_AND_VIDEO&&u.length<2)return;delete o._promiseMaps[n],u.forEach((function(e){return r.addTrack(e.__innerGetMediaStreamTrack())})),c({id:s.id,stream:Object.assign(Object.assign({},s.stream),{mediaStream:r,enable:b(r)})})}},n._ctrl.onAudioMuteChange=function(t){var n=!t.isOwnerMuted(),r=i._streamMaps[t.getStreamId()],a=n?o._options.unmuted:o._options.muted;a&&a({id:t.getUserId(),stream:{tag:t.getTag(),type:e.StreamType.AUDIO,mediaStream:r,enable:b(r)}})},n._ctrl.onVideoMuteChange=function(t){var n=!t.isOwnerMuted(),r=i._streamMaps[t.getStreamId()],a=n?o._options.enabled:o._options.disabled;a&&a({id:t.getUserId(),stream:{tag:t.getTag(),type:e.StreamType.VIDEO,mediaStream:r,enable:b(r)}})},n._ctrl.on("onLeaveRoom",n._onLeaveRoom,s(n)),n}return u(i,[{key:"get",value:function(t){return R(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(null==t?void 0:t.screen)){r.next=2;break}return r.abrupt("return",t.desktopStreamId?C({video:{getDisplayMedia:{chromeMediaSource:"desktop",chromeMediaSourceId:t.desktopStreamId}}}):Promise.reject({code:n.RCRTCCode.PARAMS_ERROR,msg:"Failed to get screen shared stream, illegal desktopStreamId"}));case 2:return i=t||{audio:!0,video:_},o=i.video,!1===o?i.video=!1:o?(a=o.resolution,a&&a in e.Resolution&&(e.Resolution[a],s=T[e.Resolution[a]],i.video=Object.assign(Object.assign({},o),s))):i.video=_,r.abrupt("return",C(i));case 5:case"end":return r.stop()}}),r)})))}},{key:"publish",value:function(t){return R(this,void 0,void 0,regeneratorRuntime.mark((function r(){var o,a,s,c,u,d,l,f,v,g,p=this;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=t.stream,a=o.tag,s=o.type,c=o.mediaStream,u=s===e.StreamType.VIDEO,d=s===e.StreamType.AUDIO,r.next=8,this._ctrl.getRTCClient().createLocalTracks(a,c,{withoutAudio:u,withoutVideo:d});case 8:if(l=r.sent,f=l.code,v=l.tracks,f===n.RCRTCCode.SUCCESS){r.next=13;break}return r.abrupt("return",Promise.reject({code:f}));case 13:return g=v[0].getStreamId(),r.abrupt("return",(i._streamMaps[g]=c,this._ctrl.checkRoomThen((function(e){return R(p,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.publish(v);case 2:return r=t.sent,i=r.code,o=r.liveUrl,t.abrupt("return",i!==n.RCRTCCode.SUCCESS?Promise.reject({code:i}):{liveUrl:o});case 6:case"end":return t.stop()}}),t)})))}))));case 15:case"end":return r.stop()}}),r,this)})))}},{key:"unpublish",value:function(e){var t=this,r=e.stream,i=r.tag,o=r.type,a=this._ctrl.getRTCClient().getCurrentId(),s=O(o,a,i);return this._ctrl.checkRoomThen((function(e){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=s.map((function(t){return e.getLocalTrack(t)})).filter((function(e){return!!e})),t.next=3,e.unpublish(r);case 3:if(i=t.sent,o=i.code,o===n.RCRTCCode.SUCCESS){t.next=7;break}return t.abrupt("return",Promise.reject({code:o}));case 7:case"end":return t.stop()}}),t)})))}))}},{key:"_subLiveAsAudience",value:function(t){return R(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,a,s,c,u,d,l,f,v,g=this;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=this._ctrl.getRTCClient().getAudienceClient(),o=t.type===e.StreamType.AUDIO?n.RCLivingType.AUDIO:n.RCLivingType.VIDEO,a=t.type===e.StreamType.AUDIO?n.RCMediaType.AUDIO_ONLY:n.RCMediaType.AUDIO_VIDEO,r.next=5,i.subscribe(t.liveUrl,o,a,t.size===e.StreamSize.MIN);case 5:if(s=r.sent,c=s.code,u=s.tracks,c===n.RCRTCCode.SUCCESS){r.next=10;break}return r.abrupt("return",Promise.reject({code:c}));case 10:return d=u[0],l=d.getStreamId(),f=d.getTag(),v=d.getUserId(),r.abrupt("return",new Promise((function(t,n){g._promiseMaps[l]={resolve:t,reject:n,options:{id:v,stream:{tag:f,type:e.StreamType.AUDIO_AND_VIDEO}},tracks:[]}})));case 12:case"end":return r.stop()}}),r,this)})))}},{key:"_unsubLiveAsAudience",value:function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this._ctrl.getRTCClient().getAudienceClient(),e.next=3,t.unsubscribe();case 3:if(r=e.sent,i=r.code,i===n.RCRTCCode.SUCCESS){e.next=7;break}return e.abrupt("return",Promise.reject({code:i}));case 7:case"end":return e.stop()}}),e,this)})))}},{key:"_subscribe",value:function(e){var t=this,r=e.id,i=e.stream,o=i.tag,a=i.type,s=O(a,r,o);return this._ctrl.checkRoomThen((function(e){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i,c,u,d,l,f=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=s.map((function(t){return e.getRemoteTrack(t)})).filter((function(e){return!!e})),c=i[0].getStreamId(),u=new Promise((function(e,t){f._promiseMaps[c]={resolve:e,reject:t,options:{id:r,stream:{tag:o,type:a}},tracks:[]}})),t.next=5,e.subscribe(i);case 5:return d=t.sent,l=d.code,t.abrupt("return",l!==n.RCRTCCode.SUCCESS?Promise.reject({code:l}):u);case 8:case"end":return t.stop()}}),t)})))}))}},{key:"subscribe",value:function(t){var n=this._ctrl.getRTCMode(),r=this._ctrl.getLiveRole();return n===e.Mode.LIVE&&r===e.ROLE.AUDIENCE?this._subLiveAsAudience(t):this._subscribe(t)}},{key:"_unsubscribe",value:function(e){var t=this,r=e.id,i=e.stream,o=i.tag,a=i.type,s=O(a,r,o);return this._ctrl.checkRoomThen((function(e){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=s.map((function(t){return e.getRemoteTrack(t)})).filter((function(e){return!!e})),0!==r.length){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.unsubscribe(r);case 5:return i=t.sent,o=i.code,t.abrupt("return",o!==n.RCRTCCode.SUCCESS?Promise.reject({code:o}):void 0);case 8:case"end":return t.stop()}}),t)})))}))}},{key:"unsubscribe",value:function(t){var n=this._ctrl.getRTCMode(),r=this._ctrl.getLiveRole();return n===e.Mode.LIVE&&r===e.ROLE.AUDIENCE?this._unsubLiveAsAudience():this._unsubscribe(t)}},{key:"resize",value:function(t){var r=this,i=t.id,o=t.stream,a=o.tag,s=o.size,c=O(e.StreamType.VIDEO,i,a);return this._ctrl.checkRoomThen((function(t){return R(r,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=c.map((function(e){return t.getRemoteTrack(e)})).filter((function(e){return!!e}))[0],r.next=3,t.subscribe([{subTiny:s===e.StreamSize.MIN,track:i}]);case 3:if(o=r.sent,a=o.code,a===n.RCRTCCode.SUCCESS){r.next=7;break}return r.abrupt("return",Promise.reject({code:a}));case 7:case"end":return r.stop()}}),r)})))}))}},{key:"setMixConfig",value:function(t){var r=this;return h.error("todo -> Stream.setMixConfig"),this._ctrl.checkAuchorThen((function(i){return R(r,void 0,void 0,regeneratorRuntime.mark((function r(){var o,a,s,c,u,d,l,f,v,g,p,m,h,R,I,y;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return o=i.getMCUConfigBuilder(),o.setMixLayoutMode(t.layoutMode),t.hostStreamId&&o.setHostVideoTrack(t.hostStreamId+"_1"),t.video&&(a=t.video,s=a.renderMode,c=a.width,u=a.height,d=a.fps,l=a.bitrate,s&&o.setOutputVideoRenderMode(s),l&&o.setOutputVideoBitrate(l),f="W".concat(c,"_H").concat(u),f in e.Resolution&&o.setOutputVideoResolution(e.Resolution[f]),f="FPS_".concat(d),f in n.RCFrameRate&&o.setOutputVideoFPS(f)),t.tinyVideo&&(v=t.tinyVideo,g=v.width,p=v.height,m=v.fps,v.bitrate,h="W".concat(g,"_H").concat(p),h in e.Resolution&&o.setOutputTinyVideoResolution(e.Resolution[h]),h="FPS_".concat(m),h in n.RCFrameRate&&o.setOutputTinyVideoFPS(h)),t.audio&&(R=t.audio.bitrate,R&&o.setOutputAudioBitrate(R)),t.customLayout&&t.customLayout.video&&t.customLayout.video.forEach((function(e){o.addCustomizeLayoutVideo(e.streamId+"_1",e.x,e.y,e.width,e.height)})),r.next=7,o.flush();case 7:if(I=r.sent,y=I.code,y===n.RCRTCCode.SUCCESS){r.next=11;break}return r.abrupt("return",Promise.reject({code:y}));case 11:case"end":return r.stop()}}),r)})))}))}},{key:"addPublishStreamUrl",value:function(e){var t=this;return this._ctrl.checkAuchorThen((function(r){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.getMCUConfigBuilder().addPublishStreamUrls([e]).flush();case 2:if(i=t.sent,o=i.code,o===n.RCRTCCode.SUCCESS){t.next=6;break}return t.abrupt("return",Promise.reject({code:o}));case 6:case"end":return t.stop()}}),t)})))}))}},{key:"removePublishStreamUrl",value:function(e){var t=this;return this._ctrl.checkAuchorThen((function(r){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.getMCUConfigBuilder().removePublishStreamUrls([e]).flush();case 2:if(i=t.sent,o=i.code,o===n.RCRTCCode.SUCCESS){t.next=6;break}return t.abrupt("return",Promise.reject({code:o}));case 6:case"end":return t.stop()}}),t)})))}))}},{key:"_onLeaveRoom",value:function(){Object.keys(i._streamMaps).forEach((function(e){var t=i._streamMaps[e];t.getTracks().forEach((function(e){e.stop(),t.removeTrack(e)})),delete i._streamMaps[e]}))}},{key:"onDestroy",value:function(){this._onLeaveRoom(),Object.keys(i._streamMaps).forEach((function(e){var t=i._streamMaps[e];t.getTracks().forEach((function(e){e.stop(),t.removeTrack(e)})),delete i._streamMaps[e]}))}}]),i}(y);S._streamMaps={};var M=function(e){return e.replace(/_[^_]+_[01]+(_tiny)?$/g,"")};Object.defineProperty(e,"LayoutMode",{enumerable:!0,get:function(){return n.MixLayoutMode}}),Object.defineProperty(e,"RenderMode",{enumerable:!0,get:function(){return n.MixVideoRenderMode}}),e.Device=function(){function e(){c(this,e)}return u(e,[{key:"get",value:function(){return navigator.mediaDevices.enumerateDevices()}}]),e}(),e.Message=function(e){d(r,e);var t=l(r);function r(e){var n;return c(this,r),n=t.call(this),n._ctrl.onMessageReceive=function(t,n,r,i){e.received({name:t,content:n,senderId:r,uId:i})},n}return u(r,[{key:"send",value:function(e){var t=this;return this._ctrl.checkRoomThen((function(r){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.sendMessage(e.name,e.content);case 2:return i=t.sent,o=i.code,t.abrupt("return",o===n.RCRTCCode.SUCCESS?Promise.resolve():Promise.reject({code:o}));case 5:case"end":return t.stop()}}),t)})))}))}}]),r}(y),e.Monitor=function(e){d(n,e);var t=l(n);function n(e){var r;return c(this,n),r=t.call(this),r._options=Object.assign({},e),r._ctrl.onMonitorListener=function(e){var t,n;null===(n=(t=r._options).stats)||void 0===n||n.call(t,function(e){var t=e.receivers,n=e.senders,r=e.iceCandidatePair,i=(e.timestamp,function(e){return function(e,t){var n,r,i,o,a;return{mediaType:t.kind,googTrackId:t.trackId,googCodecName:"",audioLevel:(null===(n=t.audioLevel)||void 0===n?void 0:n.toString())||"",samplingRate:"",frameRate:(null===(r=t.frameRate)||void 0===r?void 0:r.toString())||"",packLostReceivedRate:(null===(i=t.packetsLostRate)||void 0===i?void 0:i.toString())||"",trackReceived:t.bitrate.toString(),resolution:t.frameWidth&&t.frameHeight?[t.frameWidth,t.frameHeight].join("x"):"",googFirsReceived:"",googRenderDelayMs:"",googJitterReceived:(null===(o=t.jitter)||void 0===o?void 0:o.toString())||"",googNacksReceived:"",googPlisReceived:"",googRtt:(null===(a=null==e?void 0:e.rtt)||void 0===a?void 0:a.toString())||"",codecImplementationName:"",trackState:"",streamId:t.trackId.replace(/_[01](_tiny)?$/,"")}}(r,e)});return{sender:{deviceId:"",sendBand:(null==r?void 0:r.availableOutgoingBitrate)||0,receiveBand:(null==r?void 0:r.availableIncomingBitrate)||0,totalRate:(null==r?void 0:r.bitrateSend)||0,tracks:n.map(i),networkType:(null==r?void 0:r.networkType)||"unknown",rtt:(null==r?void 0:r.rtt)||0,localAddress:(null==r?void 0:r.IP)||"",packetsLost:NaN},received:{totalRate:(null==r?void 0:r.bitrateRecv)||0,rtt:(null==r?void 0:r.rtt)||0,tracks:t.map(i)}}}(e))},r}return n}(y),e.Report=function(e){d(n,e);var t=l(n);function n(e){var r;return c(this,n),r=t.call(this),r._options=Object.assign({},e),r._ctrl.onReportListener=function(e){var t=e.receivers,n=e.senders,i=r._options.spoke;if(i){var o=n.filter((function(e){return"audio"===e.kind})).map((function(e){return{stream:{audioLevel:e.audioLevel},id:M(e.trackId)}}));o.push.apply(o,a(t.filter((function(e){return"audio"===e.kind})).map((function(e){return{stream:{audioLevel:e.audioLevel},id:M(e.trackId)}})))),o.forEach(i)}},r}return u(n,[{key:"start",value:function(e){h.warn("`Report.start()` has been deprecated.")}}]),n}(y),e.RongRTCVideoFps={10:10,15:15,24:24,30:30},e.Room=function(e){d(r,e);var t=l(r);function r(e){var n;return c(this,r),n=t.call(this),n._options=Object.assign({},e),n._ctrl.onUserJoin=function(t){return t.forEach((function(t){var n;return null===(n=e.joined)||void 0===n?void 0:n.call(e,{id:t})}))},n._ctrl.onUserLeave=function(t){return t.forEach((function(t){var n;return null===(n=e.left)||void 0===n?void 0:n.call(e,{id:t})}))},n._ctrl.onKickOff=function(){var t;return null===(t=e.kick)||void 0===t?void 0:t.call(e)},n}return u(r,[{key:"join",value:function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctrl.join(this._options.id));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"leave",value:function(){return this._ctrl.leaveRoom()}},{key:"get",value:function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctrl.checkRoomThen((function(e){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var r,i,o,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=this._options.id,i=e.getRemoteUserIds().length+1,t.next=4,e.getRoomAttributes([]);case 4:return o=t.sent,a=o.code,s=o.data,t.abrupt("return",a===n.RCRTCCode.SUCCESS?Object.assign(Object.assign({},s),{id:r,total:i}):{id:r,total:i});case 8:case"end":return t.stop()}}),t,this)})))})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getSessionId",value:function(){var e=this;return this._ctrl.checkRoomThen((function(t){return R(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",t.getSessionId());case 1:case"end":return e.stop()}}),e)})))}))}},{key:"getStats",value:function(){var e=this;return this._ctrl.checkRoomThen((function(t,r){return R(e,void 0,void 0,regeneratorRuntime.mark((function e(){var i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i={},o=function(e){return{tag:e.getTag(),state:e.isLocalMuted()||e.isOwnerMuted()?0:1,mediaType:e.isAudioTrack()?n.RCMediaType.AUDIO_ONLY:n.RCMediaType.VIDEO_ONLY}},e.abrupt("return",(t.getRemoteUserIds().forEach((function(e){i[e]=t.getRemoteTracksByUserId(e).map(o)})),i[r]=t.getLocalTracks().map(o),i));case 2:case"end":return e.stop()}}),e)})))}))}}]),r}(y),e.Storage=function(e){d(r,e);var t=l(r);function r(){return c(this,r),t.apply(this,arguments)}return u(r,[{key:"_set",value:function(e,t,r){var i=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Storage.set";return h.debug("".concat(JSON.stringify(a)," -> key: ").concat(e,", value: ").concat(t,", msg: ").concat(JSON.stringify(r))),this._ctrl.checkRoomThen((function(s){return R(i,void 0,void 0,regeneratorRuntime.mark((function i(){var c,u;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,s.setRoomAttribute(e,t,r,o);case 2:return c=i.sent,u=c.code,i.abrupt("return",u===n.RCRTCCode.SUCCESS?(h.info("".concat(JSON.stringify(a)," succeed -> key: ").concat(e,", value: ").concat(t,", msg: ").concat(JSON.stringify(r))),Promise.resolve()):(h.error("".concat(JSON.stringify(a)," failed -> code: ").concat(u,", key: ").concat(e,", value: ").concat(t)),Promise.reject({code:u})));case 5:case"end":return i.stop()}}),i)})))}))}},{key:"_get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Storage.get",o="string"==typeof e?[e]:e;return h.debug("".concat(JSON.stringify(i)," -> keys: ").concat(o)),this._ctrl.checkRoomThen((function(e){return R(t,void 0,void 0,regeneratorRuntime.mark((function t(){var a,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getRoomAttributes(o,r);case 2:return a=t.sent,s=a.data,c=a.code,t.abrupt("return",c===n.RCRTCCode.SUCCESS?(h.info("".concat(JSON.stringify(i)," succeed -> keys: ").concat(o)),s):(h.error("".concat(JSON.stringify(i)," failed -> keys: ").concat(o)),Promise.reject({code:c})));case 6:case"end":return t.stop()}}),t)})))}))}},{key:"_remove",value:function(e,t){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Storage.remove";return h.debug("".concat(JSON.stringify(i)," -> key: ").concat(e,", msg: ").concat(JSON.stringify(t))),this._ctrl.checkRoomThen((function(o){return R(r,void 0,void 0,regeneratorRuntime.mark((function r(){var a,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o.deleteRoomAttributes([e],t);case 2:if(a=r.sent,s=a.code,s===n.RCRTCCode.SUCCESS){r.next=6;break}return r.abrupt("return",(h.error("".concat(JSON.stringify(i)," failed -> code: ").concat(s,", key: ").concat(e)),Promise.reject({code:s})));case 6:h.info("".concat(JSON.stringify(i)," succeed -> key: ").concat(e));case 7:case"end":return r.stop()}}),r)})))}))}},{key:"set",value:function(e,t,n){return this._set(e,t,n)}},{key:"get",value:function(e){return this._get(e)}},{key:"remove",value:function(e,t){return this._remove(e,t)}},{key:"__innerSet",value:function(e,t,n){return this._set(e,t,n,!0,"Storage.__innerSet")}},{key:"__innerGet",value:function(e){return this._get(e,!0,"Stroage.__innerGet")}},{key:"__innerRemove",value:function(e,t){return this._remove(e,t,!0,"Stroage.__innerRemove")}}]),r}(y),e.Stream=S,e.changeLiveRole=function(e){var t=I.getInstance();if(!t){var n="RCRTCAdapter not initialized yet.";return h.error(n),Promise.reject(n)}return t.changeLiveRole(e)},e.destroy=function(){I.getInstance()?I.destroy():h.warn("RCRTCAdapter not initialized yet.")},e.init=function(e){if(e&&e.client)if(I.getInstance())h.error("RCRTCAdapter repeat initialize!");else{var n=e.debug,r=e.logger;n&&h.setLogLevel(t.LogLevel.DEBUG),r&&h.setLogStdout((function(e,t){return r(t)})),h.warn("RCRTCAdapter Version: 1.0.5, CommitId: b4edeeb9f1dfbbd9b8395c2d74ba0bac4fc34afd"),I.init(e)}else h.error("RCRTCAdapter init failed -> `client` is invalid.")},Object.defineProperty(e,"__esModule",{value:!0})}))},"46e6":function(e,t,n){"use strict";n("6fc4")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function i(e,t,n,i,o,a){var s=Object(r["s"])("router-view");return Object(r["o"])(),Object(r["c"])(s)}var o={name:"App"};n("46e6");o.render=i;var a=o,s=n("6c02"),c=Object(r["f"])("h3",null,"通话管理：",-1),u=Object(r["e"])(" 发送方操作： "),d=Object(r["e"])(" 接收方操作： "),l=Object(r["f"])("h3",null,"视频管理：",-1),f=Object(r["f"])("h3",null,"音频管理：",-1),v=Object(r["f"])("pre",{style:{"text-align":"left"}},[Object(r["e"])("    "),Object(r["f"])("h3",null,"Web 端挂断原因："),Object(r["e"])("\n      状态码\t说明\t                \n        1\t己方取消已发出的通话请求\t     \n        2\t己方拒绝收到的通话请求\t       \n        3\t己方挂断\t                   \n        4\t己方忙碌\t                   \n        5\t己方未接听\t                 \n        6\t己方不支持当前引擎\t          \n        7\t己方网络错误\t               \n        8\t其他设备已处理\t \n       11 对方取消已发出的通话请求\n       12\t对方拒绝收到的通话请求\n       13\t对方挂断\n       14\t对方忙碌\n       15\t对方未接听\n       16 对方不支持当前引擎\n       17\t对方网络错误\n       18\tCallLib 不可用            \n    ")],-1),g=Object(r["f"])("div",{id:"box"},null,-1);function p(e,t,n,i,o,a){return Object(r["o"])(),Object(r["c"])("div",null,[c,Object(r["f"])("p",null,[u,Object(r["f"])("button",{onClick:t[1]||(t[1]=function(t){return e.handelCall(2)})},"发起视频通话"),Object(r["f"])("button",{onClick:t[2]||(t[2]=function(t){return e.handelCall(1)})},"发起音频通话"),Object(r["f"])("button",{onClick:t[3]||(t[3]=function(){return e.handelHungup&&e.handelHungup.apply(e,arguments)})},"挂断通话"),3===o.conversationType?(Object(r["o"])(),Object(r["c"])("button",{key:0,onClick:t[4]||(t[4]=function(){return e.handelInvite&&e.handelInvite.apply(e,arguments)})}," 邀请通话(只能在群组情况下) ")):Object(r["d"])("",!0)]),Object(r["f"])("p",null,[d,Object(r["f"])("button",{onClick:t[5]||(t[5]=function(t){return e.handelAccept(2)})},"接听视频通话"),Object(r["f"])("button",{onClick:t[6]||(t[6]=function(t){return e.handelAccept(1)})},"接听音频通话"),Object(r["f"])("button",{onClick:t[7]||(t[7]=function(){return e.handelHungup&&e.handelHungup.apply(e,arguments)})},"挂断通话"),Object(r["f"])("button",{onClick:t[8]||(t[8]=function(){return e.handelReject&&e.handelReject.apply(e,arguments)})},"拒绝通话")]),l,Object(r["f"])("button",{onClick:t[9]||(t[9]=function(){return e.handelSetVideoProfile&&e.handelSetVideoProfile.apply(e,arguments)})},"分辨率设置"),Object(r["f"])("button",{onClick:t[10]||(t[10]=function(){return e.handelVideoToAudio&&e.handelVideoToAudio.apply(e,arguments)})},"视频转音频"),f,Object(r["f"])("button",{onClick:t[11]||(t[11]=function(){return e.handelMute&&e.handelMute.apply(e,arguments)})},"麦克风设置"),v,g])}var m,h,R,I,y,T={code:200,userId:"allen",token:"37GlFWd0MztWEhQb6ixrS6ynOhNw/ADqVIl7FZ6ScJQ=@5q2p.cn.rongnav.com;5q2p.cn.rongcfg.com",appkey:"vnroth0kvahzo",targetId:"jack"},_={code:200,userId:"jack",token:"/j/O3Utm340sd7VauWc8lPTPm2EGLmNf0ZMlrsMyRyo=@5q2p.cn.rongnav.com;5q2p.cn.rongcfg.com",appkey:"vnroth0kvahzo",targetId:"allen"},C="group1",O="group2",E="chatroom1",b={allen:T,jack:_,group1:C,group2:O,chatroom1:E},S=n("3f82"),M=n("721c"),k=n("063a"),U=n("703a"),A=!1,w={mounted:function(){console.log("参数：",this.$route.query),this.user=b[this.$route.query.user]||b.allen,console.log("userId:",this.user.userId),"allen"===this.user.userId?(this.targetId="jack",y="jack"):(this.targetId="allen",y="allen"),3==this.$route.query.type&&(this.conversationType=3,this.targetId="group1"),this.handelInit()},methods:{handelInit:function(){m=k["init"]({appkey:this.user.appkey}),m.watch({status:function(e){console.log("连接状态码:",e.status)},message:function(e){console.log("收到新消息:",e.message)}}),h=m.install(U["installer"],{}),m.install(M["installer"]);var e={timeout:2e4,RongIMLib:k,RongRTC:h,RongRTCAdapter:S};R=M["init"](e),m.connect({token:this.user.token}).then((function(e){console.log("链接成功, 链接用户 id 为: ",e.id)})).catch((function(e){console.log("链接失败: ",e.code,e.msg)}));var t=function(e){console.log("视频监听 result",e),console.log(e.data);var t=e.type,n=document.getElementById("box");if("added"===t){var r=e.data;console.log(r),n.appendChild(r)}else if("removed"===t){r=e.data;n.removeChild(r)}};R.videoWatch(t);var n=function(e){var t=e.messageType;console.log("消息监听",t,e),I=e,console.log((new Date).getSeconds())};R.commandWatch(n)},handelCall:function(e){var t={conversationType:this.conversationType,targetId:this.targetId,inviteUserIds:[y],mediaType:e,extra:{test:"extra name"}};console.log(t),R.call(t,(function(e){e&&console.error("发起通话失败",e),console.log((new Date).getSeconds())}))},handelInvite:function(){var e="group1",t={conversationType:3,targetId:e,inviteUserIds:["test"],mediaType:M["VoIPMediaType"].MEDIA_VIDEO};R.invite(t,(function(e){e&&console.error("邀请通话失败",e)}))},handelAccept:function(e){var t={conversationType:I.conversationType,targetId:I.targetId,mediaType:e};R.accept(t,(function(t){t&&console.error("MediaType:",e,",接听通话失败",t)}))},handelHungup:function(){var e={conversationType:this.conversationType,targetId:this.targetId};R.hungup(e,(function(e){e&&console.error("挂断通话失败",e)}))},handelReject:function(){var e={conversationType:this.conversationType,targetId:this.targetId};R.reject(e,(function(e){e&&console.error("拒绝通话失败",e)}))},handelSetVideoProfile:function(){var e=40;M["setVideoProfile"](e)},handelVideoToAudio:function(){R.videoToAudio()},handelMute:function(){A?R.unmute():R.mute(),A=!A}}},L={mixins:[w],data:function(){return{user:null,targetId:null,conversationType:1}}};L.render=p;var N=L,x=Object(s["a"])({history:Object(s["b"])(),routes:[{path:"/",component:N}]}),D=Object(r["b"])(a);D.use(x),D.mount("#app")},"6fc4":function(e,t,n){},"721c":function(e,t,n){var r,i,o=n("7037").default;n("d3b7"),n("ac1f"),n("466d"),n("a15b"),n("5319"),n("25f0"),n("a434"),n("fb6a"),n("159b"),n("a630"),n("3ca3"),n("caad"),n("2532"),n("99af"),n("d81d"),function(a,s){"object"==o(t)&&"undefined"!=typeof e?e.exports=s():(r=s,i="function"===typeof r?r.call(t,n,t,e):r,void 0===i||(e.exports=i))}(0,(function(){"use strict";var e={camera:!0},t=function(){},n=function(e){return"[object Object]"===Object.prototype.toString.call(e)},r=function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=function(e){return"[object Undefined]"===Object.prototype.toString.call(e)},o=function(e,n){n=n||t;var i=function(){for(var t in e)n(e[t],t,e)},o=function(){for(var t=0;t<e.length;t++)n(e[t],t,e)},a=r(e),s=a?o:i;s()},a=function(e,t){if(r(e)){var i=[];return o(e,(function(e){t(e)&&i.push(e)})),i}if(n(e)){var a={};return o(e,(function(e,n){t(e)&&(a[n]=e)})),a}},s=function(){var e,t,n=navigator.userAgent,r={IE:/rv:([\d.]+)\) like Gecko|MSIE ([\d.]+)/,Edge:/Edge\/([\d.]+)/,Firefox:/Firefox\/([\d.]+)/,Opera:/(?:OPERA|OPR).([\d.]+)/,WeChat:/MicroMessenger/i,QQBrowser:/QQBrowser\/([\d.]+)/,Chrome:/Chrome\/([\d.]+)/,Safari:/Version\/([\d.]+).*Safari/,iOSChrome:/Mobile\/([\d.]+).*Safari/};for(var i in r){var o;if(r.hasOwnProperty(i))if(o=n.match(r[i])){t=i,e=o[1]||o[2];break}}return{type:t||"UnKonw",version:e||"UnKonw"}},c=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","g","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","G","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","0"],n=t.length+1,r=+e,i=[];do{var o=r%n;r=(r-o)/n,i.unshift(t[o])}while(r);return i.join("")},u=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)}))},d={noop:t,ObserverList:function(){var e=function(e,t){return-1<e&&e<t};this.observerList=[],this.add=function(e,t){t&&(this.observerList.length=0),this.observerList.push(e)},this.get=function(t){if(e(t,this.observerList.length))return this.observerList[t]},this.count=function(){return this.observerList.length},this.removeAt=function(t){e(t,this.observerList.length)&&this.observerList.splice(t,1)},this.remove=function(e){if(e){e="[object Function]"==Object.prototype.toString.call(e)?[e]:e;for(var t=0,n=this.observerList.length;t<n;t++)if(this.observerList[t]===e[t]){this.removeAt(t);break}}else this.observerList.length=0},this.notify=function(e){for(var t=0,n=this.observerList.length;t<n;t++)this.observerList[t](e)},this.indexOf=function(e,t){for(var n=t||0,r=this.observerList.length;n<r;){if(this.observerList[n]===e)return n;n++}return-1}},cache:function(){var e={},t=function(t,n){e[t]=n},n=function(t){return e[t]},r=function(t){delete e[t]};return{set:t,get:n,update:function(e,n){t(e,n)},remove:r,clear:function(){e={}}}},forEach:o,extend:function(e,t){for(var n in t)e[n]=t[n];return e},array2Obj:function(e){var t={};return o(e,(function(e){t[e]=e})),t},isNumber:function(e){return"[object Number]"==Object.prototype.toString.call(e)},isArray:r,isObject:n,isSupportedBrowser:function(){var e=s(),t=e.type;return-1!==["Chrome","Safari","IE"].indexOf(t)},isSupportedPlatform:function(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,r=0;r<t.length;r++)if(0<e.indexOf(t[r])){n=!1;break}return n},isSupportedProtocol:function(){var e=location.hostname,t=location.protocol,n=s();return!("IE"!==n.type)||"localhost"===e||"127.0.0.1"===e||-1!==t.indexOf("https")},console:console,getVideoAudioStream:function(e){var t=e.width,n=e.height,r=e.audioDeviceId,o=e.videoDeviceId,s=!0;return(t&&n||!!o)&&(s=a({width:t,height:n,deviceId:o},(function(e){return!i(e)}))),navigator.mediaDevices.getUserMedia({video:s,audio:!r||{deviceId:r}}).then((function(e){return e}),(function(){return navigator.mediaDevices.getUserMedia({video:!0,audio:!1})})).then((function(e){return e}),(function(){return navigator.mediaDevices.getUserMedia({video:!1,audio:!0})}))},getAudioStream:function(t){var n=t.audioDeviceId;return navigator.mediaDevices.getUserMedia({video:!1,audio:!n||{deviceId:n}}).then((function(e){for(var t=e.getVideoTracks(),n=0,r=t.length;n<r;n++)t[n].enabled=!1;return Promise.resolve(e)}),(function(){return e.camera=!1,navigator.mediaDevices.getUserMedia({video:!1,audio:!0})}))},deviceEnable:e,getUUID22:function(){var e=u();if(e=e.replace(/-/g,"")+"a",e=parseInt(e,16),e=c(e),22<e.length&&(e=e.slice(0,22)),22>e.length)for(var t=22-e.length,n=0;n<t;n++)e+="0";return e}},l=void 0,f=void 0,v=void 0,g=!1,p=function(){return l},m=function(){return f},h=function(){return v},R=function(){return g},I={getRongIMLib:p,setRongIMLib:function(e){l=e},getRongRTC:m,setRongRTC:function(e){f=e},setRongRTCAdapter:function(e){g=!0,v=e},getRongRTCAdapter:h,setNeedAdapterRTC:function(e){g=e},getNeedAdapterRTC:R},y={Reason:{CANCEL1:{code:1,info:"Self side cancelled outgoing calling request"},REJECT2:{code:2,info:"Self side refused incomming calling request"},HANGUP3:{code:3,info:"Self side hung up"},BUSYLINE4:{code:4,info:"Self side is busy"},NO_RESPONSE5:{code:5,info:"Self side did not answered the call"},ENGINE_UN_SUPPORTED6:{code:6,info:"Current engine is not supported by self side"},NETWORK_ERROR7:{code:7,info:"Network exception on self side"},OTHER_CLIENT_HANDLED8:{code:8,info:"Request was handled on other device"},REMOTE_CANCEL11:{code:11,info:"Peer side cancelled calling request"},REMOTE_REJECT12:{code:12,info:"Peer side refused calling request"},REMOTE_HANGUP13:{code:13,info:"Peer side hung up during call"},REMOTE_BUSYLINE14:{code:14,info:"Peer side is busy"},REMOTE_NO_RESPONSE15:{code:15,info:"Peer side did not answered the call"},REMOTE_ENGINE_UN_SUPPORTED16:{code:16,info:"Current engine is not supported by peer side"},REMOTE_NETWORK_ERROR17:{code:17,info:"Network exception on peer side"},VOIP_NOT_AVALIABLE18:{code:18,info:"VoIP is not avaliable"},DEVICE_ERROR:{code:19,info:"Failed to access microphone or camera"}},CallStatus:{CallIdle:0,Dialing:1,Incoming:2,Ringing:3,Active:4,Hangup:5},VoIPMediaType:{MEDIA_AUDIO:1,MEDIA_VEDIO:2,1:"MEDIA_AUDIO",2:"MEDIA_VEDIO"},StorageType:{ROOM:1,USER:2,INNERUSER:3}},T=y.VoIPMediaType,_=y.Reason,C={OnlyAudio:0,All:1,OnlyVideo:2,None:3},O="RongCloudRTC",E=void 0,b=void 0,S=void 0,M=void 0,k=void 0,U=d.noop,A=!1,w={VIDEO_PROFILE_240P:{width:320,height:240},VIDEO_PROFILE_480P:{width:640,height:480},VIDEO_PROFILE_720P:{width:1280,height:720}},L={},N=function(){if(!b)throw new Error("Not call yet, please call first.");return b},x=function(e,t){var n;return n=e&&t?C.All:e?C.OnlyVideo:t?C.OnlyAudio:C.None,n},D=function(e,t){var n=document.createElement("video");return n.id=t,n.autoplay=!0,n.controls=!1,n.srcObject=e,n},P=function(e){return e},j=function(e){var t=e.id,n=e.stream,r=t===E,i=void 0,o=void 0,a=void 0;if(n){var s=n.enable,c=n.mediaStream,u=P(t);i=D(c,u),o=x(s.video,s.audio),i.muted=t===E,i.setAttribute("userid",t),a=n.tag}var d={type:"added",data:i,talkType:o,isLocal:r,tag:a};U(null,d)},V=function(e){var t=e.id,n=e.stream,r=n.enable,i=r.video,o=r.audio,a=n.tag,s=t===E,c=x(i,o);U(null,{type:"added",talkType:c,isLocal:s,tag:a})},B=function(e){if(A){var t=b.StreamSize;e.stream.size=t.MAX,M.subscribe(e).then((function(e){L.isIE?V(e):j(e)}),(function(e){console.error(e),U("stream subscribe error")}))}},H=function(e){e=e||{};var t={type:"removed",data:e.id,userId:e.id,isLocal:!1};U(null,t)},W=function(e,t){var n=b.StreamType,r=e===T.MEDIA_AUDIO?n.AUDIO:n.AUDIO_AND_VIDEO,i={id:E},o=e===T.MEDIA_VEDIO,a=o?d.getVideoAudioStream:d.getAudioStream;return a(L).then((function(e){i.stream={mediaStream:e,type:r,tag:O},t(null,i)})).catch((function(){t(null,i)}))},J=function(e){var t=e.mediaType,n=b.StreamType,r=t===T.MEDIA_AUDIO?n.AUDIO:n.AUDIO_AND_VIDEO,i={id:E,stream:{tag:O,type:r,enable:{video:t!==T.MEDIA_AUDIO,audio:!0}}};M.publish(i).then((function(){})).catch((function(e){console.error("publish self stream error",e)})),V(i)},F=function(e){var t=M.video;W(e.mediaType,(function(n,r){return n?U(_.DEVICE_ERROR.code,_.DEVICE_ERROR.info):(r.isLocal=!0,r.stream?(M.publish(r).then((function(){e.mediaType===T.MEDIA_AUDIO&&t.disable({id:E,stream:{tag:O}})}),(function(e){console.error("publish self stream error",e)})),r.stream.enable={video:e.mediaType!==T.MEDIA_AUDIO,audio:!0}):console.error("Microphone and camera not captured, Can't get your own stream"),void j(r))}))},q=function(e){S=new b.Room({id:e,left:H})},G=function(){return M=new b.Stream({published:B}),M},K=function(e){q(e.channelId)},z=function(e){d.extend(L,e),e.engineId&&(L.isIE=!0);var t=I.getRongRTC(),n=I.getRongIMLib();if(I.getNeedAdapterRTC()){var r=I.getRongRTCAdapter(),i=I.getRongRTC();r.init({client:i}),b=r}else b=new t({id:L.engineId,RongIMLib:n,mode:t.RTC,error:function(e){U(null,{type:"error",error:e})}});return k=new b.Storage({type:y.StorageType.INNERUSER}),G(),M},Y=function(e,t){U=t||d.noop,E=e.userId,K(e);var n={id:E,token:E};S.join(n).then((function(){A=!0,k.__innerSet("role",e.role),L.isIE?J(e):F(e)}),(function(e){console.log("join room error",e),U("join error.")}))},Q=function(e,t){return t=t||d.noop,b&&S&&A?void S.leave().then((function(){A=!1,U(null,{type:"leave"}),t()}),(function(){t(),U("leave error.")})):t()},$=function(e){var t=!e.isEnabled,n=M.audio,r=t?n.mute:n.unmute;r({id:E,stream:{tag:O}})},X=function(e){var t=!e.isEnabled,n=M.video,r=t?n.disable:n.enable;r({id:E,stream:{tag:O}})},Z=function(){var e=b.ScreenShare;e.start().then((function(){}),(function(){U("screenshare error.")}))},ee=function(){var e=b.ScreenShare;e.stop()},te=function(){var e=b.WhiteBoard;e.create().then((function(e){if(e.url){var t={index:"meet",type:"whiteBoardURL",url:e.url};U(t)}else U("request whiteboard error.")}))},ne=function(){return S?S.getSessionId():null},re={setConfig:z,joinRoom:Y,quitRoom:Q,enableAudio:$,enableVideo:X,getMediaID:function(e){var t=e.sentTime;return(2147483647&t)+""},startScreenShare:Z,stopScreenShare:ee,requestWhiteBoardURL:te,setVideoProfile:function(e){var t=w[e]||w.VIDEO_PROFILE_480P;d.extend(L,t)},setMediaDevice:function(e){d.extend(L,e)},getRTCPeer:N,getSessionId:ne},ie=function(e){var t=e.SDK_VERSION;if(t){var n=["RC:VCAccept","RC:VCRinging","RC:VCSummary","RC:VCHangup","RC:VCInvite","RC:VCModifyMedia","RC:VCModifyMem"],r={AcceptMessage:"RC:VCAccept",RingingMessage:"RC:VCRinging",SummaryMessage:"RC:VCSummary",HungupMessage:"RC:VCHangup",InviteMessage:"RC:VCInvite",MediaModifyMessage:"RC:VCModifyMedia",MemberModifyMessage:"RC:VCModifyMem"},i=function(e){var t=e.messageType;for(var n in e.offLineMessage=e.isOffLineMessage,e.conversationType=e.type,r){var i=r[n];i===t&&(e.messageType=n)}return e};return{callMessageWatch:function(t){var r=e.getInstance();if(!r.rtcInnerWatch)throw new Error("Please upgrade RongIMLib");r.rtcInnerWatch({message:function(e){var r=e.message;-1!==n.indexOf(r.messageType)&&(r=i(r),t(r))}})},getCurrentUserId:function(){var t=e.getInstance();return t.getConnectionUserId()},sendMessage:function(t,n){var o=t.conversationType,a=t.targetId,s=t.content,c=t.messageType,u=t.pushText,d=t.appData,l=t.userIds,f=e.getInstance();return f.Conversation.get({type:o,targetId:a}).send({content:s,messageType:r[c],pushContent:u,pushData:d,directionalUserIdList:l}).then((function(e){e=i(e),n(null,e)})).catch((function(e){var t=e.code;n(t)}))}}}var o=function(t){var n={AcceptMessage:e.AcceptMessage,RingingMessage:e.RingingMessage,SummaryMessage:e.SummaryMessage,HungupMessage:e.HungupMessage,InviteMessage:e.InviteMessage,MediaModifyMessage:e.MediaModifyMessage,MemberModifyMessage:e.MemberModifyMessage},r=t.content,i=n[t.messageType]||function(){};return new i(r)};return{callMessageWatch:function(t){e.RongIMClient._voipProvider={onReceived:t}},getCurrentUserId:function(){return e.RongIMClient.getInstance().getCurrentUserId()},sendMessage:function(t,n){n=n||function(){};var r=o(t),i=t.conversationType,a=t.targetId,s=t.channelId,c=s?e.RongIMClient.getInstance().getChannel(s):e.RongIMClient.getInstance(),u=t.pushText||"",d=t.appData||"";c.sendMessage(i,a,r,{onSuccess:function(e){n(null,e)},onError:function(e){n(e)}},!1,u,d,null,t)}}},oe={PUSH_TITLE:{audio:"您有一条音频通话",video:"您有一条视频通话"}},ae={zh:oe,en:{PUSH_TITLE:{audio:"You have a voice call",video:"You have a video call"}}},se={lang:oe,set:function(e){se.lang=ae[e]||oe}},ce=void 0,ue={"RC:VCAccept":"AcceptMessage","RC:VCRinging":"RingingMessage","RC:VCSummary":"SummaryMessage","RC:VCHangup":"HungupMessage","RC:VCInvite":"InviteMessage","RC:VCModifyMedia":"MediaModifyMessage","RC:VCModifyMem":"MemberModifyMessage"},de=["RC:VCAccept","RC:VCRinging","RC:VCSummary","RC:VCHangup","RC:VCInvite","RC:VCModifyMedia","RC:VCModifyMem"],le=function(e){return Object.assign(e,{messageType:ue[e.messageType],objectName:e.messageType,offLineMessage:e.isOffLineMessage})},fe={setCallMsgWatch:function(e){ce=e},installer:{tag:"RCCallLib",verify:function(e){return!("browser"!==e.tag)||(console.error("RongCallLib Plugin not support the runtime "+e.tag),!1)},setup:function(e){return e.onmessage=function(e){var t=-1<de.indexOf(e.messageType);return!!t&&(ce(le(e)),!0)},{isCallInstaller:!0}}}},ve=d.ObserverList,ge=[],pe=function(){return ie(I.getRongIMLib())},me=function(){var e=pe();if(!e)return console.error("Missing RongIMLib, please pass in RongIMLib in init"),"";var t=e.getCurrentUserId();return t||(console.error("Please connect im first"),"")},he=function(e,t,n){var r=pe();t=t||d.noop,e.userIds=n||e.inviteUserIds,r.sendMessage(e,(function(e,n){e?t(e):(ge.unshift(n.messageUId),ge.length>500&&ge.pop(),t(e,n))}),n)},Re={invite:function(e,t){e.messageType="InviteMessage";var n=e.content,r=n.mediaType,i=n.inviteUserIds,o=n.callId,a={1:se.lang.PUSH_TITLE.audio,2:se.lang.PUSH_TITLE.video};e.pushText=a[r],e.appData=JSON.stringify({mediaType:r,userIdList:i,callId:o}),e.userIds=i,he(e,t,i)},ringing:function(e,t){e.messageType="RingingMessage",he(e,t)},accept:function(e,t,n){e.messageType="AcceptMessage",he(e,t,n)},hungup:function(e,t,n){e.messageType="HungupMessage";var r=e.content.callId,i=e.content.reason;e.appData=JSON.stringify({callId:r,reason:i}),he(e,t,n)},mediaModify:function(e,t){e.messageType="MediaModifyMessage",he(e,t)},memberModify:function(e,t){e.messageType="MemberModifyMessage";var n=e.content,r=[],i=n.inviteUserIds,o=n.existedMemberStatusList,a=me();d.forEach(i,(function(e){e!==a&&r.push(e)})),d.forEach(o,(function(e){var t=e.userId;t!==a&&r.push(t)})),e.userIds=r,he(e,t,r)},getToken:function(e,t){t(null,"")}},Ie=new ve,ye={sendCommand:function(e,t,n){var r=e.command,i=e.data;Re[r]&&Re[r](i,t,n)},watch:function(e){Ie.add(e)},setVoipProvider:function(){var e=pe(),t=I.getNeedAdapterRTC()?fe.setCallMsgWatch:e.callMessageWatch;t((function(e){var t=-1<ge.indexOf(e.messageUId);e.offLineMessage||t||Ie.notify(e)}))},getCurrentUserId:me},Te=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},_e=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},Ce=y.Reason,Oe=re.joinRoom,Ee=re.quitRoom,be=re.enableAudio,Se=re.enableVideo,Me=re.getMediaID,ke=ye.sendCommand,Ue=ye.getCurrentUserId,Ae=d.cache(),we=d.ObserverList,Le=new we,Ne=new we,xe=new we,De=new we,Pe={url:"https://rtcapi.ronghub.com/nav/websocketlist",timeout:3e4,ices:[{urls:"turn:119.254.101.80:3478",credential:"test",username:"test"}]};Ae.set("videoQueue",{});var je={},Ve={},Be={SENT:1,RECEIVED:2},He=function(e){var t={};return["extra"].forEach((function(n){t[n]=e[n]})),t},We={single:function(e){var t=e.senderUserId,n=je[t];n&&n.stop()},multi:function(){d.forEach(je,(function(e,t){e&&e.stop(),delete je[t]})),Ae.remove("inviteUsers")}},Je={CallIdle:0,Dialing:1,Incoming:2,Ringing:3,Active:4,Hangup:5},Fe=function(){var e={CANCEL1:{code:1,info:"Self side cancelled outgoing calling request"},REJECT2:{code:2,info:"Self side refused incomming calling request"},HANGUP3:{code:3,info:"Self side hung up"},BUSYLINE4:{code:4,info:"Self side is busy"},NO_RESPONSE5:{code:5,info:"Self side did not answered the call"},ENGINE_UN_SUPPORTED6:{code:6,info:"Current engine is not supported by self side"},NETWORK_ERROR7:{code:7,info:"Network exception on self side"},OTHER_CLIENT_HANDLED8:{code:8,info:"Request was handled on other device"},REMOTE_CANCEL11:{code:11,info:"Peer side cancelled calling request"},REMOTE_REJECT12:{code:12,info:"Peer side refused calling request"},REMOTE_HANGUP13:{code:13,info:"Peer side hung up during call"},REMOTE_BUSYLINE14:{code:14,info:"Peer side is busy"},REMOTE_NO_RESPONSE15:{code:15,info:"Peer side did not answered the call"},REMOTE_ENGINE_UN_SUPPORTED16:{code:16,info:"Current engine is not supported by peer side"},REMOTE_NETWORK_ERROR17:{code:17,info:"Network exception on peer side"},VOIP_NOT_AVALIABLE18:{code:18,info:"VoIP is not avaliable"}},t=function(t){return d.isNumber(t)&&d.forEach(e,(function(e,n){-1<n.indexOf(t)&&(t=n)})),t};return{get:function(n){return n=t(n),e[n]}}}(),qe={1:function(){return Fe.get("REMOTE_CANCEL11")},2:function(){return Fe.get("REMOTE_REJECT12")},3:function(){return Fe.get("REMOTE_HANGUP13")},4:function(){return Fe.get("REMOTE_BUSYLINE14")},5:function(){return Fe.get("REMOTE_NO_RESPONSE15")},15:function(){return Fe.get("NO_RESPONSE5")}},Ge=function(){this.timeout=0,this.startTime=0,this.start=function(e,t){t=t||0,e&&(this.timeout=setTimeout((function(){e()}),t)),this.startTime=+new Date},this.stop=function(){clearTimeout(this.timeout);var e=+new Date,t=this.startTime,n=e-t;return 0===t&&(n=0),{start:t,end:e,duration:n}},this.clear=function(){this.startTime=0}},Ke=new Ge,ze=function(e,t){var n=e.channelId;e={command:"getToken",engineType:4,data:{channelId:n}},ke(e,t)},Ye=function(e){var t=e.info;throw new Error(t)},Qe=function(e){e.session||Ye(e)},$e=function(e){var t=e?"single":"multi";We[t](e)},Xe={isActive:!1,init:function(e,t){this.isActive||(e.url=Pe.url,e.ices=Pe.ices,Oe(e,t),this.isActive=!0)},reset:function(){this.isActive=!1,Ae.remove("session"),Ae.remove("initRoom")}},Ze=function(e){var t=e.session||Ae.get("session")||{},n=Fe.get(e.reasonKey),r=t.conversationType,i=t.targetId,o=t.channelId,a=Ke.stop();Ke.clear();var s=t.senderUserId,c=t.senderUserId,u=t.content,d=u.mediaType,l=u.inviteUserIds,f=t.userOnLine||{},v=e.noneedRoomReset;if(1===r&&f[s]){var g=qe[n.code];g&&(n=g())}var p={channelId:o,conversationType:r,targetId:i,messageDirection:t.messageDirection,content:{caller:s,inviter:c,mediaType:d,startTime:a.start,duration:a.duration,status:n.code,memberIdList:l},senderUserId:c,messageType:"SummaryMessage"};return xe.notify(p),v||Xe.reset(),Ae.remove("hungupReason"),p},et=function(e,t){t=t||d.noop;var n=Ae.get("session");e.session=n;var r=e.from;Qe({session:n,info:r+": Not call yet"});var i=n.content.callId,o=n.conversationType,a=n.targetId,s=e.reasonKey,c=Fe.get(s),u=!e.passive;if(u){var l={command:"hungup",data:{conversationType:o,targetId:a,content:d.extend({callId:i,reason:c.code},He(e)),channelId:e.channelId}};Ee({roomId:i},(function(){ke(l,(function(n){if(!n){var r=Ze(e);t(null,r)}}))}))}else Ee({roomId:i},(function(){var n=Ze(e);t(null,n)}));Ae.get("joinRoom")&&Ae.remove("joinRoom"),$e()},tt=function(e){var t=e.userIds,n=e.conversationType,r=e.targetId,i=e.channelId,o=Ue()||Pe.currentUserId;d.forEach(t,(function(t){var a=je[t]=new Ge,s=t===o||1===n,c=e.status;a.status=c,a.mediaType=e.mediaType;var u=Pe.timeout;s||(u+=e.timeout||0);var d={sent:function(e){var t=e.status===Je.Dialing,o=t?"REMOTE_NO_RESPONSE15":"NO_RESPONSE5",a=Ae.get("inviteUsers")||{};et({channelId:i,conversationType:n,targetId:r,from:"call-timeout",reasonKey:o},(function(e,t){var n=t.senderUserId;delete a[n]}))},local:function(){var e=Fe.get("NO_RESPONSE5"),o=Ae.get("session"),a={reason:e.code,callId:o.content.channelInfo.Id};De.notify({messageType:"HungupMessage",channelId:i,conversationType:n,targetId:r,senderUserId:t,content:a,messageDirection:2})}};a.start((function(){var e=s?"sent":"local";d[e](a)}),u)}))},nt=function(e,t,n){ze(e,(function(r,i){if(r)throw new Error(r);e.token=i;var o={added:function(e){var t=e.data,n=t.getAttribute("userid");e.userId=n,t.setAttribute("userId",n)}};Xe.init(e,(function(e,r){if(t=t||d.noop,e)throw t(e,r),new Error(e);if("error"===r.type)throw Ze({reasonKey:"NETWORK_ERROR7"}),new Error("RTC Connect Error.");if(!r.isLeft){"added"===r.type&&r.isLocal&&t(null,n);var i=r.type,a=r.index,s=o[i];if(s&&s(r),"meet"===a)Ne.notify(r);else{var c=r.sourceId,u=r.userId;if(+u!==c)Le.notify(r);else{var l=Ae.get("videoQueue");l[c]=r}}}}))}))},rt=function(e){var t={};return d.forEach(e,(function(e){t[e]=e})),t},it=function(e){return 3===e},ot=function(e,t){var n=Ae.get("session");return n[e]=t,n[t]=e,{userId:t,sender:e}},at=function(e){var t=e.senderUserId,n=Me(e);return ot(t,n)},st={busy:function(e){var t="BUSYLINE4",n=Fe.get(t),r=1===e.messageDirection;r&&(t="HANGUP3");var i=e.content.callId,o={callId:i,reason:n.code},a=e.conversationType,s=e.targetId,c=e.channelId,u=Ue(),d=void 0;if(3===a){d=[e.senderUserId];var l=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){e===u||d.includes(e)||d.push(e)}))};"InviteMessage"===e.messageType?l.apply(void 0,_e(e.content.inviteUserIds)):"MemberModifyMessage"===e.objectName&&l.apply(void 0,_e(e.content.inviteUserIds).concat(_e(e.content.existedUserPofiles.map((function(e){return e.userId})))))}ke({command:"hungup",data:{channelId:c,conversationType:a,targetId:s,content:o}},null,d)},free:function(e,t,n){Ae.set("session",e),xe.notify(e);var r=e.sentTime,i=e.senderUserId;t?at({sentTime:r,senderUserId:i}):e.content.existedUserPofiles.map((function(e){ot(e.userId,e.mediaId)}));var o=e.content,a=o.callId,s=e.conversationType,c=e.targetId,u=e.channelId,d=o.inviteUserIds;Ae.set("inviteUsers",rt(d));var l=o.mediaType,f={channelId:u,conversationType:s,targetId:c,userIds:d,mediaType:l,status:Je.Incoming};if(tt(f),n){var v={channelId:u,conversationType:s,targetId:c,userIds:[e.senderUserId],mediaType:l,status:Je.Active};tt(v),$e(e),ke({command:"ringing",data:{channelId:u,conversationType:s,targetId:c,content:{callId:a}}})}}},ct=function(e){var t=Ae.get("videoQueue"),n=e.data,r=n.getAttribute("userid"),i=Ae.get("session");r in i&&(delete t[r],r=i[r]||r,e.sourceId=r,n.setAttribute("userid",r),Le.notify(e))},ut=function(e){var t=e.conversationType,n=e.targetId,r=e.channelId,i=Ae.get("session"),o=i.senderUserId,a=o,s=i.content,c=s.mediaType,u=s.inviteUserIds,d=Fe.get("OTHER_CLIENT_HANDLED8"),l={channelId:r,conversationType:t,targetId:n,messageDirection:2,content:{caller:o,inviter:a,mediaType:c,startTime:0,duration:0,status:d.code,memberIdList:u},senderUserId:a,messageType:"SummaryMessage"};xe.notify(l),Ae.remove("session")},dt={InviteMessage:function(e){var t=Ue()||Pe.currentUserId;if(t!==e.senderUserId){var n=Ae.get("session"),r=n?"busy":"free";st[r](e,!0,!0);var i=e.content.callId;Ve[i]=e;var o=Ae.get("cacheHungupMessage");o&&e.content.callId===o.content.callId&&dt.HungupMessage(o),"busy"===r&&Ze({reasonKey:"BUSYLINE4",noneedRoomReset:!0,session:e})}},RingingMessage:function(e){var t=e.senderUserId,n=je[t];n&&(n.stop(),n.status=Je.Ringing);var r=Ae.get("session");if(r){var i=r.userOnLine||{};i[t]=!0,r.userOnLine=i,xe.notify(e)}},AcceptMessage:function(e){function t(){return Ae.get("initRoom")&&o===Ue()}function n(){return o===Ue()}var r=Ae.get("session");if(r){var i=r.params,o=r.senderUserId;!t()&&n()&&(Ae.set("initRoom",!0),i.role="RC_CallInviter",nt(i));var a=e.senderUserId,s=e.sentTime,c=at({sentTime:s,senderUserId:a}),u=Ae.get("videoQueue"),d=u[c.userId]||u[c.sender];d&&ct(d);var l=1===e.messageDirection;if(l)return void ut(e);var f=e.content;e.callInfo={mediaType:f.mediaType,status:Je.Active},$e(e);var v=r.content.channelInfo,g=v.Id,p=r.callInfo||{};if(p[g]){r.already=!0,Ke.start();var m=je[a]||{stop:function(){},status:Je.Active,mediaType:f.mediaType};m.status=Je.Active,je[a]=m,xe.notify(e)}}},HungupMessage:function(e){var t=Ue()||Pe.currentUserId,n=Ae.get("inviteUsers")||{},r=e.senderUserId,i=Ae.get("session"),o=Ve[e.content.callId];if(4!==e.content.reason||o||t!=r){if(i){var a=i.content,s=a.channelInfo.Id,c=e.content,u=c.callId;if(s===u){e.callInfo={mediaType:a.mediaType,status:Je.Hangup},$e(e),delete n[r],delete je[r];var l=e.messageDirection===Be.RECEIVED;if(l){var f=e.content,v=f.reason;3===v&&0===Ke.startTime&&(v=2);var g=qe[v]||d.noop,p=g()||{};v=p.code||v,e.content.reason=v,Ae.set("hungupReason",v)}else ut(e);Ve[e.content.callId]&&delete Ve[e.content.callId],xe.notify(e)}}}else Ae.set("cacheHungupMessage",e)},MediaModifyMessage:function(e){xe.notify(e)},MemberModifyMessage:function(e){console.warn("MemberModifyMessage =>",e),e.content.existedUserPofiles?e.content.existedMemberStatusList=e.content.existedUserPofiles:e.content.existedUserPofiles=e.content.existedMemberStatusList;var t=e.content.existedUserPofiles||[];t.forEach((function(e){je[e.userId]={status:Je.Active,stop:function(){},mediaType:e.mediaType}})),st.free(e,!1,!1)},otherMessage:function(e){xe.notify(e)}};(function(e){De.add(e)})((function(e){var t=e.messageType;t=t in dt?t:"otherMessage";var n=dt[t];n(e)}));var lt=function(){var e=Math.floor(1e3*Math.random()),t=d.getUUID22(),n=[t,Date.now(),e];return n.join("_")},ft=function(e,t){var n=e.content,r=n.callId,i=n.mediaType,o=e.isSharing,a=n.inviteUserIds,s=e.conversationType,c=e.targetId;Ae.set("inviteUsers",rt(a)),ke({command:"invite",data:e},(function(e,n){if(e)t({code:e});else{var u={};u[r]=!0,n.callInfo=u,n.isSharing=o;var l=n.sentTime,f=n.senderUserId,v=n.userOnLine={};d.forEach(a,(function(e){v[e]=!1})),Ae.update("session",n),at({sentTime:l,senderUserId:f}),n.params={channelId:r,userId:f,sentTime:l,mediaType:i,isSharing:o},t({code:null},n);var g={conversationType:s,targetId:c,userIds:a,timer:10,mediaType:i,status:Je.Dialing};tt(g);var p={conversationType:s,targetId:c,userIds:[f],timer:10,mediaType:i,status:Je.Active};tt(p),$e(n)}}))},vt=function(e,t){var n=Ae.get("session");if(n)t(Fe.get("BUSYLINE4"));else{var r=e.engineType||4;Ae.set(t,e),t=t||d.noop;var i=e.conversationType,o=e.targetId,a=e.mediaType,s=e.isSharing,c=[];1===i?c.push(o):c=e.inviteUserIds;var u=lt(e),l=e.observerUserIds||[],f={isSharing:s,conversationType:i,targetId:o,content:d.extend({sharing:s,engineType:r,inviteUserIds:c,observerUserIds:l,mediaType:a,callId:u,channelInfo:{Key:"",Id:u}},He(e)),channelId:e.channelId};ft(f,(function(e,n){t(e.code,n)}))}},gt=function(e,t){var n=e.content,r=n.inviteUserIds,i=Ae.get("inviteUsers")||{};d.forEach(r,(function(e){i[e]=e}));var o=e.conversationType,a=e.targetId,s=e.content.mediaType;ke({command:"memberModify",data:e},(function(e,n){t({code:e},n);var i={conversationType:o,targetId:a,userIds:r,timer:10,mediaType:s,status:Je.Dialing};tt(i)}))},pt=function(e,t){var n=Ae.get("session");Qe({session:n,info:"Invite: Not call yet"}),t=t||d.noop,n=Ae.get("session");var r=e.conversationType,i=e.targetId,o=n.content,a=o.callId,s=n.senderUserId,c=e.engineType||4,u=e.mediaType,l=e.inviteUserIds,f=[];d.forEach(je,(function(e,t){var r=n[t],i={userId:t,mediaId:Me({sentTime:r,userId:t}),mediaType:e.mediaType,callStatus:e.status};f.push(i)}));var v=Ue()||Pe.currentUserId,g=n[v],p={userId:v,mediaId:Me({sentTime:g,userId:v}),mediaType:u,callStatus:Je.Active},m=f.map((function(e){return e.userId}));0>m.indexOf(p.userId)&&f.push(p);var h=e.observerUserIds||[],R={conversationType:r,targetId:i,content:d.extend({modifyMemType:1,callId:a,caller:s,engineType:c,channelInfo:{Key:"",Id:a},mediaType:u,inviteUserIds:l,existedMemberStatusList:f,existedUserPofiles:f,observerUserIds:h,extra:e.extra},He(e)),channelId:e.channelId};gt(R,(function(e,n){t(e.code,n)}))},mt=function(e,t){t=t||d.noop;var n=e.conversationType,r=e.targetId,i=e.userType,o=e.mediaType,a=e.isSharing,s=e.inviteUserIds,c=Ae.get("session"),u=e.from;Qe({session:c,info:u+": Not call yet"});var l=e.engineType,f=c.content,v=f.callId;e={command:"accept",data:{conversationType:n,targetId:r,content:d.extend({callId:v,mediaType:o},He(e)),channelId:e.channelId}},ke(e,(function(e,r){if(e)return t(e);var s=r.sentTime,c=f.callId,u=r.senderUserId;r.callInfo={mediaType:f.mediaType,status:Je.Active},$e(r),at({sentTime:s,senderUserId:u});var d={channelId:c,userId:u,sentTime:s,mediaType:o,isSharing:a,engineType:l,userType:i};je[u]?je[u].status=Je.Active:je[u]={status:Je.Active,stop:function(){},mediaType:o},3===n&&Ae.set("joinRoom",!0),d.role="RC_CallInvitee",nt(d,t,r),Ke.start()}),s)},ht=function(e,t){e.from="accept",mt(e,t)},Rt=function(e){e.from="join",mt(e)},It=function(e,t){e.from="hungup";var n="CANCEL1";d.forEach(je,(function(e,t){e.status===Je.Active&&t!==Ue()&&(n="HANGUP3")}));var r=e.conversationType;if(e.passive&&(n=Ae.get("hungupReason")||n,it(r))){var i=je[Ue()];n=i&&i.status===Je.Active?"REMOTE_HANGUP13":"NO_RESPONSE5"}e.reasonKey=n,et(e,t)},yt=function(e,t){e=e||{},e.from="reject",e.reasonKey="REJECT2",et(e,t)},Tt=function(){be({isEnabled:!1})},_t=function(){be({isEnabled:!0})},Ct=function(e,t){var n=Ae.get("session"),r=n.content,i=r.callId,o=n.conversationType,a=n.targetId,s=n.channelId;n.content.mediaType=e,Ae.get("session",n),ke({command:"mediaModify",data:{conversationType:o,targetId:a,content:{callId:i,mediaType:e},channelId:s}},t)},Ot=function(e){Se({isEnabled:!1}),Ct(1,e)},Et=function(e){var t=d.deviceEnable;if(!t.camera)return e&&e(Ce.DEVICE_ERROR.code,Ce.DEVICE_ERROR.info);Se({isEnabled:!0}),Ct(2,e)},bt=function(){re.requestWhiteBoardURL()},St=function(e){Le.remove(),Le.add(e)},Mt=function(e){Ne.remove(),Ne.add(e)},kt=function(){throw"`meetCommandWatche` deprecated，please use `meetCommandWatch` instead"},Ut=function(e){xe.remove(),xe.add(e)},At={20:"VIDEO_PROFILE_240P",40:"VIDEO_PROFILE_480P",50:"VIDEO_PROFILE_720P"},wt=function(e){var t=At[e];re.setVideoProfile(t)},Lt=function(e){e=e||{},re.setMediaDevice(e)},Nt=function(e){re.startScreenShare(e)},xt=function(){re.stopScreenShare()},Dt=function(){return re.getSessionId()},Pt=function(){var e=Ae.get("session"),t=e.content;return t.callId},jt=function(e,t){return e.watch?e.watch((function(e){De.notify(e)})):ye.watch((function(e){De.notify(e)})),{videoWatch:St,commandWatch:Ut,call:vt,invite:pt,accept:ht,hungup:It,reject:yt,join:Rt,mute:Tt,unmute:_t,videoToAudio:Ot,audioToVideo:Et,meetCommandWatche:kt,meetCommandWatch:Mt,requestWhiteBoardURL:bt,startScreenShare:Nt,stopScreenShare:xt,setVideoProfile:wt,setMediaDevice:Lt,rongRTCStream:t,getSessionId:Dt,getCallId:Pt}},Vt=function e(t){if(Te(this,e),!t.RongIMLib)throw new Error("Please import Web IM SDK: http://www.rongcloud.cn/docs/web.html#sdk");var n=!!t.RongRTC.joinRTCRoom;if(n&&!t.RongRTCAdapter)throw new Error("Please import Web Plugin RTC Adapter");d.extend(Pe,t),I.setRongIMLib(t.RongIMLib),I.setRongRTC(t.RongRTC),I.setRongRTCAdapter(t.RongRTCAdapter),I.setNeedAdapterRTC(n),ye.setVoipProvider();var r=re.setConfig(Pe);return t.sendCommand&&(ke=t.sendCommand),jt(t,r)},Bt={init:function(e){return se.set(e.lang),new Vt(e)},installer:fe.installer},Ht=d.extend(Bt,y);return Ht}))}});
//# sourceMappingURL=app.6391385c.js.map